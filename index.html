<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Mafia Game</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="dns-prefetch" href="/socket.io/">
  <link rel="preload" href="style.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <noscript><link rel="stylesheet" href="style.css"></noscript>
  <style>
    /* Critical CSS for initial page load */
    body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background-color: #1a1a1a; color: #ffffff; }
    #main-menu { text-align: center; max-width: 800px; margin: 0 auto; padding: 20px; }
    .game-title { color: #ff6b6b; font-size: 3.5rem; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5); font-weight: bold; }
    .primary-btn { background: linear-gradient(145deg, #4ecdc4, #45b7aa); color: white; border: none; padding: 15px 30px; font-size: 1.1rem; font-weight: bold; border-radius: 12px; cursor: pointer; transition: all 0.3s ease; }
  </style>
</head>
<body>
  <div id="main-menu">
    <div class="hero-section">
      <h1 class="game-title">🕵️ Mafia 🔫</h1>
      <p class="game-subtitle">The Ultimate Social Deduction Experience</p>
    </div>

    <div class="game-description">
      <h3>🎭 How to Play</h3>
      <p>This is a <strong>real-life social game</strong> where you sit together in person and use this app to coordinate the game mechanics.</p>

      <div class="features-grid compact">
        <div class="feature-card small">
          <div class="feature-icon">👥</div>
          <h4>Gather Friends</h4>
        </div>
        <div class="feature-card small">
          <div class="feature-icon">🌙</div>
          <h4>Night & Day Phases</h4>
        </div>
        <div class="feature-card small">
          <div class="feature-icon">🎯</div>
          <h4>Multiple Roles</h4>
        </div>
        <div class="feature-card small">
          <div class="feature-icon">💬</div>
          <h4>Built-in Chat</h4>
        </div>
      </div>
    </div>

    <div class="action-buttons">
      <button class="primary-btn" onclick="showHostSetup()">
        <span class="btn-icon">🎮</span>
        Host a Game
      </button>
      <button class="secondary-btn" onclick="showJoinSetup()">
        <span class="btn-icon">🔗</span>
        Join a Game
      </button>
    </div>

    <div class="tips-section">
      <h4>💡 Pro Tips</h4>
      <ul class="tips-list">
        <li>Encourage dramatic accusations and defenses</li>
        <li>Set reasonable timers to keep the game moving</li>
      </ul>
    </div>
  </div>

  <div id="host-setup" style="display:none;">
    <div class="page-container">
      <div class="page-header">
        <h1 class="page-title">🎮 Create a Game</h1>
        <p class="page-subtitle">Set up your Mafia game session</p>
      </div>

      <div class="setup-section">
        <div class="section-card">
          <h3>🎲 Lobby Setup</h3>
          <div class="input-group">
            <button class="primary-btn" onclick="generateLobbyCode()">Generate Code</button>
            <input id="lobby-code" placeholder="Lobby Code" class="styled-input" />
            <button class="danger-btn" onclick="resetLobbyCode()">Reset</button>
          </div>
        </div>

        <div class="section-card">
          <h3>⚙️ Game Configuration</h3>
          <div class="config-grid">
            <div class="config-item">
              <label>Mafia Count:</label>
              <input id="mafia-count" type="number" value="2" min="1" max="5" class="number-input" />
            </div>
            <div class="config-item">
              <label>Queen Count:</label>
              <input id="queen-count" type="number" value="1" min="0" max="3" class="number-input" />
            </div>
            <div class="config-item">
              <label>Detective Count:</label>
              <input id="detective-count" type="number" value="1" min="0" max="3" class="number-input" />
            </div>
            <div class="config-item">
              <label>Round Timer (0 = no timer):</label>
              <input id="round-timer" type="number" value="0" min="0" max="300" class="number-input" />
            </div>
            <div class="config-item checkbox-item">
              <label>Show voted player roles:</label>
              <input id="show-voted-roles" type="checkbox" />
            </div>
          </div>
        </div>

        <div class="section-card">
          <h3>👥 Players</h3>
          <div class="player-setup">
            <div class="input-group">
              <input id="new-player-name" placeholder="Player Name" class="styled-input" />
              <button class="primary-btn" onclick="addPlayerName()">Add Player</button>
              <button class="danger-btn" onclick="removeLastPlayer()">Remove Last</button>
            </div>
            <ul id="player-list" class="styled-player-list"></ul>
            <p id="player-count" class="player-count-display">Players: 0</p>
          </div>
        </div>

        <div class="action-buttons">
          <button class="primary-btn large" onclick="createLobby()">
            <span class="btn-icon">🚀</span>
            Create Lobby
          </button>
          <button class="secondary-btn large" onclick="showMainMenu()">
            <span class="btn-icon">⬅️</span>
            Back
          </button>
        </div>
      </div>
    </div>
  </div>

  <div id="join-setup" style="display:none;">
    <div class="page-container">
      <div class="page-header">
        <h1 class="page-title">🔗 Join a Game</h1>
        <p class="page-subtitle">Enter the lobby code to join an existing game</p>
      </div>

      <div class="setup-section">
        <div class="section-card">
          <h3>🎯 Join Game</h3>
          <div class="join-form">
            <div class="input-group vertical">
              <label for="join-code">Lobby Code</label>
              <input id="join-code" placeholder="Enter 4-character code" class="styled-input large" />
            </div>
            <div class="input-group vertical">
              <label for="join-name">Your Name</label>
              <input id="join-name" placeholder="Enter your name" class="styled-input large" />
            </div>
          </div>
        </div>

        <div class="action-buttons">
          <button class="primary-btn large" onclick="joinLobby()">
            <span class="btn-icon">🎮</span>
            Join Game
          </button>
          <button class="secondary-btn large" onclick="showMainMenu()">
            <span class="btn-icon">⬅️</span>
            Back
          </button>
        </div>
      </div>
    </div>
  </div>

  <div id="game-container" style="display:none;">
    <div id="game-header">
      <div class="game-menu">
        <button class="menu-btn" onclick="toggleGameMenu()">⋮</button>
        <div id="game-menu-dropdown" class="menu-dropdown" style="display:none;">
          <button onclick="leaveLobby()">⚐ Leave Game</button>
          <button onclick="toggleChat()">💬 Toggle Chat</button>
        </div>
      </div>
      <h2 id="phase-indicator">Waiting for game to start...</h2>
      <div id="timer-display"></div>
      <div id="player-status">Status: Unknown</div>
      <div id="lobby-details" style="display:none;">
        <span>Lobby code: <span id="display-lobby-code" class="lobby-code"></span></span>
        <span>You are: <span id="display-player-list"></span></span>
      </div>
    </div>

    <div id="role-info">
      <h3>Your Role: <span id="role-text"></span></h3>
      <div id="mafia-extra" style="display:none;">
        <div class="mafia-section">
          <h4>Other Mafia:</h4>
          <ul id="mafia-list"></ul>
        </div>
        <div id="mafia-coordination" class="mafia-section" style="display:none;">
          <h4>Mafia Kill Votes:</h4>
          <div id="mafia-votes-display"></div>
        </div>
      </div>
      <div id="spectator-info" style="display:none;">
        <p>You are now a spectator. You can watch the game but cannot participate.</p>
      </div>


    </div>

    <div id="night-actions" style="display:none;"></div>
    <div id="day-voting" style="display:none;"></div>

    <div id="chat-toggle">
      <div id="chat-icon" onclick="toggleChat()">💬</div>
      <div id="chat-notification" style="display:none;">🔴</div>
    </div>

    <div id="chat-container" style="display:none;">
      <div id="chat-header">
        <h4>Game Chat</h4>
        <button id="chat-close" onclick="toggleChat()">×</button>
      </div>
      <div id="chat-messages"></div>
      <div id="chat-input-container" style="display:none;">
        <input id="chat-input" placeholder="Type your message..." maxlength="200" />
        <button onclick="sendChatMessage()">Send</button>
      </div>
    </div>

    <div id="game-messages"></div>
    <div id="alive-players">
      <h4>Alive Players:</h4>
      <ul id="alive-list"></ul>
      <h4>Dead Players:</h4>
      <ul id="dead-list"></ul>
    </div>
  </div>

  <div id="game-over" style="display:none;">
    <h1 id="winner-text"></h1>
    <p id="win-reason"></p>
    <button onclick="replayGame()">Play Again</button>
    <button onclick="showMainMenu()">Return to Menu</button>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script src="script.js"></script>
</body>
</html>